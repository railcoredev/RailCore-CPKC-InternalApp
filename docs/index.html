<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RAILCORE – CPKC Worker App v3.8.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles/style.css" />
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="header">
      <div>
        <div class="logo">
          <span class="rail">RAIL</span><span class="core">CORE</span>
        </div>
        <div class="header-sub">CPKC – Worker Crossing / Sidings / Tracks</div>
      </div>
      <div class="header-meta">
        <div class="header-meta-line">Internal Worker Tool</div>
        <div class="header-meta-line small">v3.8.1</div>
      </div>
    </header>

    <!-- STATE FILTER ABOVE STICKY -->
    <section class="filter-block">
      <div class="field-label">State(s)</div>
      <select id="stateSelector" class="multiselect" multiple>
        <!-- Populated by app.js using snapshot -->
      </select>
    </section>

    <!-- STICKY BAR (Subdivision, EC, Spacing, Buffer, View, Buttons) -->
    <section class="sticky-bar">
      <!-- Row 1: Subdivision + Emergency Contact -->
      <div class="sticky-row">
        <div class="sticky-col">
          <div class="sticky-label">Subdivision</div>
          <select id="subdivisionSelector" class="sticky-subdivision-select">
            <!-- Populated by app.js -->
          </select>
        </div>
        <div class="sticky-col">
          <div class="sticky-label">Emergency Contact</div>
          <div class="sticky-ec-text">
            CPKC Emergency: 1-800-766-7912
          </div>
        </div>
      </div>

      <!-- Row 2: Spacing + Buffer + View Mode -->
      <div class="sticky-row">
        <div class="sticky-col">
          <div class="sticky-label">Spacing (ft) & Buffer</div>
          <div class="sticky-inline">
            <input id="spacingInput" type="number" value="5500" />
            <input id="bufferInput" type="number" value="400" placeholder="Buffer" />
          </div>
        </div>

        <div class="sticky-col">
          <div class="sticky-label">View Mode</div>
          <div class="viewmode-row">
            <label><input type="radio" name="viewMode" value="threshold" checked /> ≥ Threshold</label>
            <label><input type="radio" name="viewMode" value="all" /> All</label>
          </div>
        </div>
      </div>

      <!-- Buttons Row -->
      <div class="buttons-row">
        <button id="applyBtn" class="btn btn-primary">Apply</button>
        <button id="printBtn" class="btn">Print</button>
        <button id="downloadBtn" class="btn">Download</button>
      </div>
    </section>

    <!-- TABS -->
    <nav class="tabs">
      <button class="tab active" data-tab="crossings">Crossings</button>
      <button class="tab" data-tab="sidings">Sidings</button>
      <button class="tab" data-tab="tracks">Track Lengths</button>
    </nav>

    <!-- RESULTS -->
    <section class="results-panel">
      <!-- Yard selector only appears when Tracks tab is active -->
      <div id="yardSelectorRow" class="yard-selector-row hidden">
        <div class="sticky-label">Yard</div>
        <select id="yardSelector" class="sticky-subdivision-select">
          <!-- Populated in Tracks tab only -->
        </select>
      </div>

      <pre id="resultsOutput" class="results-output">
      </pre>
    </section>

    <div class="footer-version">
      RAILCORE CPKC WORKER APP · v3.8.1
    </div>
  </div>

  <!-- Download "Save As" Modal -->
  <div id="downloadModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">Download Results</div>
      <div class="modal-body">
        <label class="modal-label">
          File name
          <input id="downloadFilename" type="text" value="railcore_results" />
        </label>

        <label class="modal-label">
          File type
          <select id="downloadFiletype">
            <option value="txt">Plain Text (.txt)</option>
            <option value="csv">CSV (.csv)</option>
            <option value="json">JSON (.json)</option>
          </select>
        </label>
      </div>
      <div class="modal-footer">
        <button id="downloadCancelBtn" class="btn">Cancel</button>
        <button id="downloadConfirmBtn" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <script src="data_loader.js"></script>
  <script src="app.js"></script>
</body>
</html>
