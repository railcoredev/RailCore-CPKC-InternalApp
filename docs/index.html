<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>RAILCORE — CPKC Worker App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Main stylesheet -->
    <link rel="stylesheet" href="css/style.css" />

    <!-- PWA-friendly basics (you can keep your existing manifest/service worker as-is) -->
    <meta name="theme-color" content="#1b232f" />
</head>
<body>
    <div class="rc-app-shell">
        <!-- HEADER -->
        <header class="rc-header">
            <div class="rc-header-left">
                <div class="rc-logo">
                    <span class="rc-logo-rail">RAIL</span><span class="rc-logo-core">CORE</span>
                </div>
                <div class="rc-header-subtitle">
                    CPKC Worker App — Crossings &amp; Track Lengths
                </div>
            </div>
            <div class="rc-header-right">
                <div class="rc-header-meta">
                    <span class="rc-meta-label">Mode:</span>
                    <span class="rc-meta-value">Assignment / Reference</span>
                </div>
                <div class="rc-header-meta">
                    <span class="rc-meta-label">User:</span>
                    <span class="rc-meta-value">Worker</span>
                </div>
            </div>
        </header>

        <!-- TAB BAR -->
        <nav class="rc-tab-bar">
            <button class="rc-tab rc-tab-active" data-tab="tab-crossings">Crossings</button>
            <button class="rc-tab" data-tab="tab-track-lengths">Track Lengths</button>
            <button class="rc-tab" data-tab="tab-about">About</button>
        </nav>

        <!-- MAIN LAYOUT: CONTROL PANEL (STICKY) + CONTENT -->
        <div class="rc-main-layout">
            <!-- STICKY CONTROL PANEL -->
            <section class="rc-control-panel">
                <!-- Row 1: Subdivision (left) + Spacing / Buffer / Apply (right) -->
                <div class="rc-control-row rc-control-row-top">
                    <div class="rc-control-group rc-control-subdivision">
                        <label for="subdivisionSelect" class="rc-label">Subdivision</label>
                        <select id="subdivisionSelect" class="rc-select">
                            <option value="KC">KANSAS CITY SUB</option>
                            <option value="OT">OTTUMWA SUB</option>
                            <option value="DV">DAVENPORT SUB</option>
                            <option value="CH">CHICAGO SUB</option>
                            <option value="EL">ELGIN SUB</option>
                        </select>
                    </div>

                    <div class="rc-control-group rc-control-spacing" data-tab-visible="tab-crossings">
                        <div class="rc-inline-field">
                            <label for="spacingFtInput" class="rc-label">Min Spacing (ft)</label>
                            <input id="spacingFtInput" type="number" class="rc-input" value="1500" min="0" step="50" />
                        </div>
                        <div class="rc-inline-field">
                            <label for="bufferFtInput" class="rc-label">Per-End Buffer (ft)</label>
                            <input id="bufferFtInput" type="number" class="rc-input" value="200" min="0" step="50" />
                        </div>
                        <button id="applySpacingBtn" class="rc-button rc-button-primary">
                            Apply
                        </button>
                    </div>

                    <!-- Yard selector: only for Track Lengths tab (hidden by default via CSS) -->
                    <div class="rc-control-group rc-control-yard" data-tab-visible="tab-track-lengths">
                        <div class="rc-inline-field">
                            <label for="yardSelect" class="rc-label">Yard</label>
                            <select id="yardSelect" class="rc-select">
                                <!-- Populate this via JS with yards for the selected subdivision -->
                                <option value="">Select Yard</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Row 2: View Mode + Print + Download -->
                <div class="rc-control-row rc-control-row-bottom">
                    <div class="rc-control-group rc-control-viewmode" data-tab-visible="tab-crossings">
                        <label for="viewModeSelect" class="rc-label">View Mode</label>
                        <select id="viewModeSelect" class="rc-select">
                            <option value="ladder">Crossing Ladder</option>
                            <option value="raw">Raw List</option>
                        </select>
                    </div>

                    <div class="rc-control-group rc-control-viewmode" data-tab-visible="tab-track-lengths">
                        <label class="rc-label rc-label-dim">Track View</label>
                        <span class="rc-static-value">Yard / Track Lengths</span>
                    </div>

                    <div class="rc-control-group rc-control-actions">
                        <button id="printBtn" class="rc-button rc-button-ghost">
                            Print
                        </button>
                        <button id="downloadBtn" class="rc-button rc-button-ghost">
                            Download
                        </button>
                    </div>

                    <div class="rc-control-emergency">
                        EMERGENCY? Call CPKC Police / Emergency: <span class="rc-emergency-number">1-800-716-9132</span>
                    </div>
                </div>
            </section>

            <!-- CONTENT AREA (SCROLLS) -->
            <main class="rc-content">
                <!-- CROSSINGS TAB CONTENT -->
                <section id="tab-crossings" class="rc-tab-content rc-tab-content-active">
                    <div class="rc-panel">
                        <div class="rc-panel-header">
                            <div class="rc-panel-title">Crossings — Spacing Ladder</div>
                            <div class="rc-panel-subtitle">
                                Output format locked:
                                CROSSING / ↓ distance / CROSSING / (blank line)
                            </div>
                        </div>
                        <pre id="crossingsResults" class="rc-results rc-results-ladder">
Loading crossings data...
                        </pre>
                    </div>
                </section>

                <!-- TRACK LENGTHS TAB CONTENT -->
                <section id="tab-track-lengths" class="rc-tab-content">
                    <div class="rc-panel">
                        <div class="rc-panel-header">
                            <div class="rc-panel-title">Track Lengths — Yard / Track Reference</div>
                            <div class="rc-panel-subtitle">
                                Select subdivision and yard to view track lengths for each track.
                            </div>
                        </div>
                        <div id="trackLengthsContainer" class="rc-results rc-results-text">
                            Track lengths view is ready. Select a subdivision and yard above to load data.
                        </div>
                    </div>
                </section>

                <!-- ABOUT TAB CONTENT -->
                <section id="tab-about" class="rc-tab-content">
                    <div class="rc-panel">
                        <div class="rc-panel-header">
                            <div class="rc-panel-title">About — RAILCORE CPKC Worker App</div>
                        </div>
                        <div class="rc-results rc-results-text">
                            <p>
                                This internal worker tool is designed for the CPKC corridor and focuses on:
                            </p>
                            <ul>
                                <li>Crossing spacing ladders for worker planning.</li>
                                <li>Subdivision-aware, assignment-aware reference mode.</li>
                                <li>Yard / track length reference for the Track Lengths tab.</li>
                            </ul>
                            <p>
                                Crossings output:
                            </p>
<pre>
MP ####.# — COMMON NAME — Road Name — PROTECTION — DOT#XXXXXXX
    ↓ #### ft

MP ####.# — NEXT CROSSING — Road Name — PROTECTION — DOT#XXXXXXX

(blank line between blocks)
</pre>
                            <p>
                                All filtering and spacing logic runs locally for offline use. Data snapshots are sourced
                                from the embedded CPKC infrastructure data set.
                            </p>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- JS: your existing data loader / app logic -->
    <!-- Keep / adjust these as needed to match your repo structure -->
    <script src="js/data_loader.js"></script>
    <script src="js/app_worker.js"></script>

    <!-- Minimal UI wiring + loader hook -->
    <script>
        (function () {
            // Tab switching
            var tabs = document.querySelectorAll('.rc-tab');
            var tabContents = document.querySelectorAll('.rc-tab-content');
            var controlGroups = document.querySelectorAll('[data-tab-visible]');

            function setActiveTab(tabId) {
                tabs.forEach(function (btn) {
                    btn.classList.toggle('rc-tab-active', btn.getAttribute('data-tab') === tabId);
                });
                tabContents.forEach(function (section) {
                    section.classList.toggle('rc-tab-content-active', section.id === tabId);
                });

                // Show/hide tab-specific control groups
                controlGroups.forEach(function (group) {
                    var visibleFor = group.getAttribute('data-tab-visible');
                    group.style.display = (visibleFor === tabId) ? 'flex' : 'none';
                });
            }

            tabs.forEach(function (btn) {
                btn.addEventListener('click', function () {
                    var id = btn.getAttribute('data-tab');
                    setActiveTab(id);
                });
            });

            // Initialize defaults
            setActiveTab('tab-crossings');

            // Expose basic UI references for JS/data loader
            window.RCWorkerUI = {
                getSelectedSubdivision: function () {
                    return document.getElementById('subdivisionSelect').value;
                },
                getSpacingFt: function () {
                    return Number(document.getElementById('spacingFtInput').value) || 0;
                },
                getBufferFt: function () {
                    return Number(document.getElementById('bufferFtInput').value) || 0;
                },
                getViewMode: function () {
                    return document.getElementById('viewModeSelect').value;
                },
                setCrossingsText: function (text) {
                    document.getElementById('crossingsResults').textContent = text || '';
                },
                setTrackLengthsHtml: function (html) {
                    document.getElementById('trackLengthsContainer').innerHTML = html || '';
                },
                getSelectedYard: function () {
                    return document.getElementById('yardSelect').value;
                },
                setYardOptions: function (options) {
                    var select = document.getElementById('yardSelect');
                    select.innerHTML = '';
                    options.forEach(function (opt) {
                        var o = document.createElement('option');
                        o.value = opt.value;
                        o.textContent = opt.label;
                        select.appendChild(o);
                    });
                }
            };

            // Wire UI events to external app logic if present
            var applyBtn = document.getElementById('applySpacingBtn');
            var printBtn = document.getElementById('printBtn');
            var downloadBtn = document.getElementById('downloadBtn');
            var subdivisionSelect = document.getElementById('subdivisionSelect');
            var yardSelect = document.getElementById('yardSelect');
            var viewModeSelect = document.getElementById('viewModeSelect');

            function safeCall(fnName) {
                if (window.RCWorkerApp && typeof window.RCWorkerApp[fnName] === 'function') {
                    window.RCWorkerApp[fnName]();
                }
            }

            if (applyBtn) {
                applyBtn.addEventListener('click', function () {
                    safeCall('onApplySpacing');
                });
            }

            if (printBtn) {
                printBtn.addEventListener('click', function () {
                    safeCall('onPrint');
                });
            }

            if (downloadBtn) {
                downloadBtn.addEventListener('click', function () {
                    safeCall('onDownload');
                });
            }

            if (subdivisionSelect) {
                subdivisionSelect.addEventListener('change', function () {
                    safeCall('onSubdivisionChange');
                });
            }

            if (yardSelect) {
                yardSelect.addEventListener('change', function () {
                    safeCall('onYardChange');
                });
            }

            if (viewModeSelect) {
                viewModeSelect.addEventListener('change', function () {
                    safeCall('onViewModeChange');
                });
            }

            // Loader hook: let your JS take over once everything is ready
            document.addEventListener('DOMContentLoaded', function () {
                if (window.RCWorkerApp && typeof window.RCWorkerApp.init === 'function') {
                    window.RCWorkerApp.init();
                }
            });
        })();
    </script>
</body>
</html>
